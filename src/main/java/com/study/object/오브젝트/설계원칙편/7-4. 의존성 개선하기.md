---

# Game 테스트가 어려운 이유 — 핵심 요약 (DIP 관점)

## 1. 문제 요약

> **Game 클래스는 테스트 작성도 어렵고, 테스트 이해도 어렵다.**

### 이유

* 시스템 **셋업/입출력/문자열/콘솔** 등 **외부 요소에 강하게 의존**
* 테스트 코드만 보고 **게임 흐름과 결과 원인을 파악하기 어려움**
* 플레이어 상태, 이동 과정, 출력 결과가 **코드에 드러나지 않음**

---

## 2. 테스트가 어려운 핵심 원인 (2가지)

### ① 구체 클래스(Console)에 대한 직접 의존

* Game이 `Console`을 **직접 사용**
* 다른 입력/출력 구현으로 **대체 불가능**
* 테스트에서 Console을 Fake로 바꾸기 어려움

### ② 숨겨진 의존성 (Hidden Dependency)

* 입력/출력/외부 동작이 **Game 내부에 숨어 있음**
* 테스트 데이터가 **외부 파일/콘솔/환경에 묶임**
* 테스트 결과의 원인을 **외부 구현까지 추적해야 이해 가능**

---

## 3. 구조적 문제 요약 (모듈 레벨)

### 역할 구분

| 모듈          | 성격                    |
| ----------- | --------------------- |
| **Game**    | 상위 수준 모듈 (핵심 로직, 안정적) |
| **Console** | 하위 수준 모듈 (입출력, 불안정)   |

### 문제 구조 (DIP 위반)

```
Game (상위) ─▶ Console (하위 구현)
```

> **안정적인 Game이 불안정한 Console에 의존 → 변경과 테스트에 취약**

---

## 4. 해결 전략 — 의존성 역전 (DIP)

### 핵심 목표

> **Game과 Console 모두 “추상화(인터페이스)”에 의존하도록 변경**

---

## 5. 해결 방법 1 — InputOutput 인터페이스 추출

### 인터페이스 정의

* `Input`
* `Show`
* `ShowLine`

→ 콘솔 입출력 기능을 **InputOutput 인터페이스**로 추상화

---

## 6. 해결 방법 2 — Game의 의존 대상 변경

### Before

```
Game → Console
```

### After

```
Game → InputOutput Interface ← Console
```

* Game은 **Console이 아닌 인터페이스만 의존**
* Console은 인터페이스를 **구현하는 세부사항**이 됨

---

## 7. 해결 방법 3 — 의존성 주입 (DI)

### 기존 문제

* Game 내부에서 Console 인스턴스를 **직접 생성**
* 구현 교체 불가능

### 개선

* Console 인스턴스를 **외부(Main 등)에서 생성**
* 생성자를 통해 **InputOutput 타입으로 주입**

```
Main → Console 생성 → Game에 주입
```

> **Game은 구현을 모르고, 오직 계약(인터페이스)만 사용**

---

## 8. 테스트 개선 효과

### Before

* Console 출력/입력에 묶여 테스트 불가능
* 테스트 결과의 원인을 추적하기 어려움

### After

* FakeInputOutput 구현 가능
* 테스트 데이터 **직접 주입 가능**
* 테스트 코드만 보고 **입력 → 처리 → 결과 흐름 이해 가능**

> **테스트 데이터가 코드에 명시적으로 드러남**

---

## 9. 설계적으로 얻는 이점

### 구조적 이득

* Game = **안정적인 핵심 로직**
* Console = **교체 가능한 세부 구현**
* 변경 영향 범위 최소화

### 원칙 만족

* **DIP (의존성 역전 원칙)**
* **DI (의존성 주입)**
* **SRP (단일 책임 원칙)** — 외부 의존성 분리

---

## 10. 한 문장 핵심 정리

* **“Game은 Console이 아니라 InputOutput이라는 추상화에 의존해야 한다.”**
* **“외부 입출력은 핵심 로직 밖으로 밀어내야 테스트가 쉬워진다.”**
* **“숨겨진 의존성을 드러내면 코드가 이해 가능해진다.”**
* **“DIP + DI는 테스트 가능한 구조를 만든다.”**

---

## 11. 초압축 기억 버전

```
문제:
Game → Console 직접 의존 → 테스트 어려움

해결:
Console 기능을 InputOutput 인터페이스로 추상화
Game → InputOutput 의존
Console → InputOutput 구현
외부(Main)에서 주입 (DI)

결과:
구현 교체 가능
테스트 Fake 가능
핵심 로직 안정화
```

---