---

# 테스트가 명확해지는 이유 — 핵심 요약 (DIP & Hidden Dependency)

## 1. 이번 목표

> **의존성을 분리하면 테스트가 더 명확해진다는 것을 확인한다.**

* 기존 게임 테스트는 **이해하기 어렵고 결과 원인도 불명확**
* 이유는 **입력/출력/플레이어/맵 등이 숨겨진 의존성**이었기 때문

---

## 2. 테스트가 어려웠던 근본 원인

### ① 입출력(Console)에 대한 의존

* Game이 Console에 직접 의존
* 입력과 출력이 테스트 코드에 **명시적으로 드러나지 않음**

### ② 숨겨진 의존성 (Hidden Dependency)

* 플레이어 생성 위치
* 지도 구조
* 초기 플레이어 위치
* 커맨드 처리 방식
  → **모두 Game 내부에 숨겨짐**

> **테스트가 내부 구현을 분석해야만 이해 가능**

---

## 3. 1차 개선 — InputOutput 인터페이스 + FakeInputOutput

### 핵심 변경

* Console 대신 **InputOutput 인터페이스에 의존**
* FakeInputOutput 구현 추가

### FakeInputOutput 역할

#### 입력(Input)

* 미리 준비된 명령 목록 반환
* 입력 흐름을 테스트 코드에서 통제

#### 출력(Output)

* Show / ShowLine 호출 결과를 리스트에 저장
* 출력 결과를 **테스트에서 검증 가능**

> **입력과 출력이 테스트 코드에 드러남**

---

## 4. 테스트 개선 효과 (입출력 레벨)

### Before

* System.setIn, 콘솔 출력 의존
* 테스트 데이터가 코드 밖에 숨겨짐

### After

* FakeInputOutput에 **명령 리스트 전달**
* 출력 결과를 FakeOutput에 누적
* **입력 → 처리 → 출력 흐름이 명확**

---

## 5. 하지만 남아 있던 문제 — 게임 상태가 여전히 숨겨짐

### 문제 예시

* 왜 `go-north` 명령 후 다리로 이동했는지 이해 불가
* 지도 구조, 플레이어 위치가 테스트에서 보이지 않음

### 원인

* Game이 내부에서 **Player를 직접 생성**
* Player 초기 위치를 **Game 내부에서 결정**

> **입출력은 드러났지만, “게임 상태”는 여전히 숨겨짐**

---

## 6. 2차 핵심 문제 — Player & Map 의존성

### 문제 구조

```
Game 내부에서 Player 직접 생성
→ Player 상태/위치를 테스트에서 제어 불가
→ 테스트가 Game 생성자 구현에 종속됨
```

> **숨겨진 의존성 = 테스트의 적**

---

## 7. 2차 개선 — Player 의존성 명시화

### 해결 방법

* Game 생성자에 **Player를 파라미터로 전달**
* Player를 **외부(Main 또는 Test)에서 생성**

### 결과

* 테스트에서 Player 초기 위치 직접 설정 가능
* 플레이어 상태가 **테스트 코드에 명시적으로 표현됨**

---

## 8. CommandPass & 책임 분리

### 변경 사항

* CommandPass(커맨드 전달 객체) 추가
* Player, CommandPass 생성 책임을 **Main으로 이동**

### 효과

* Game = 게임 흐름만 제어
* 외부(Main/Test) = 객체 생성 담당

> **생성과 사용 분리 원칙(SRP + DIP) 충족**

---

## 9. 테스트가 어떻게 명확해졌는가?

### 이제 테스트는 다음을 **코드만 보고 이해 가능**

#### 입력

* FakeInputOutput에 전달한 명령 목록

#### 게임 상태

* Player 초기 좌표
* 지도 구조

#### 결과

* FakeInputOutput에 누적된 출력

> **테스트 = “시나리오 문서”처럼 읽힘**

---

## 10. 핵심 통찰 — 좋은 테스트 = 의존성이 드러난 설계

### 테스트가 어려운 이유

* 의존성이 숨겨져 있음

### 테스트가 쉬워지는 이유

* 의존성이 **인터페이스/생성자/파라미터로 명시됨**

> **“숨겨진 의존성을 드러내면 테스트는 자연스럽게 쉬워진다.”**

---

## 11. DIP + DI가 만든 구조적 변화

| Before        | After                |
| ------------- | -------------------- |
| Console 직접 의존 | InputOutput 인터페이스 의존 |
| Player 내부 생성  | Player 외부 주입         |
| 입력/출력 숨김      | FakeInputOutput로 제어  |
| 테스트 결과 해석 어려움 | 코드만 보고 이해 가능         |

---

## 12. 이번 내용 한 줄 요약

* **“의존성을 인터페이스로 드러내면 테스트가 명확해진다.”**
* **“숨겨진 의존성은 테스트를 어렵게 만든다.”**
* **“DIP + DI는 테스트를 문서처럼 읽히게 만든다.”**
* **“테스트하기 쉬운 설계는 품질 좋은 설계일 확률이 높다.”**

---

## 13. 초압축 기억 버전

```
문제:
입출력/플레이어/맵이 Game 내부에 숨겨짐 → 테스트 불명확

해결:
InputOutput → FakeInputOutput
Player → 생성자 주입
의존성 명시화 (DIP + DI)

결과:
입력/상태/출력이 테스트 코드에 드러남
테스트 이해도 & 유지보수성 상승
```

---