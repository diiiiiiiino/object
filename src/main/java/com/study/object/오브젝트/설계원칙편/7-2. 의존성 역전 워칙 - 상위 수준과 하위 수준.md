---

# 📌 의존성 역전 원칙 (DIP, Dependency Inversion Principle)

> **핵심 한 문장**
>
> 👉 **상위 수준 모듈과 하위 수준 모듈은 모두 추상화에 의존해야 한다.
> 추상화는 세부사항에 의존하면 안 되고, 세부사항이 추상화에 의존해야 한다.**

---

## 1️⃣ DIP를 바라보는 두 가지 관점

### ① 상위 수준 ↔ 하위 수준 관점

* **상위 수준 모듈**:

    * 비즈니스 규칙
    * 본질적인 목적 (예: 통화시간 계산)
* **하위 수준 모듈**:

    * 구현 세부사항
    * 기술적 메커니즘 (CSV 읽기, JSON 읽기, DB 접근 등)

❌ 잘못된 설계

> 상위 수준 모듈이 하위 수준 모듈(CSVReader 등)에 직접 의존

✅ 올바른 설계

> **둘 다 추상화(인터페이스)에 의존**

---

### ② 추상화 ↔ 세부사항 관점

* ❌ **추상화가 세부사항에 의존하면 안 됨**
* ✅ **세부사항이 추상화에 의존해야 함**

👉 인터페이스는 **변경 가능성이 낮아야** 하고
👉 구현체는 **언제든 교체 가능**해야 함

---

## 2️⃣ 예제 시나리오 요약 (통화 관리 시스템)

### 📞 요구사항

* CSV 파일(`calls.csv`)에 저장된 통화 기록을 읽는다
* 특정 발신 번호의 **전체 통화 시간**을 계산한다

---

## 3️⃣ 도메인 모델 구성

### ⏱️ TimeInterval (값 객체)

```text
start : 시작 시간
end   : 종료 시간
```

* `duration()`
  → 종료 - 시작 → 통화 시간 반환

---

### ☎️ Call (엔티티)

```text
from : 발신 번호
to   : 수신 번호
interval : TimeInterval
```

* `duration()`
  → 내부의 `TimeInterval.duration()`에 위임

---

## 4️⃣ 컬렉션 & 책임 분리

### 📚 CallHistory

* 특정 발신 번호의 통화 목록 보관
* `callDuration()`
  → 모든 통화의 duration 합산

---

### 📦 CallCollector (상위 수준 모듈)

**역할**

* 전체 통화 목록에서
* 특정 발신 번호의 통화만 모아서
* CallHistory 생성

---

## 5️⃣ 문제 발생 지점 ❌

### 기존 설계

```text
CallCollector → CSVReader (직접 의존)
```

### 문제

* CSV → JSON으로 바꾸면?

    * CallCollector 수정 필요 ❌
* 하위 수준 변경이 상위 수준 변경을 유발
* **DIP 위반**

---

## 6️⃣ DIP 적용: 추상화 도입 ✅

### 🔌 Reader 인터페이스

```text
read() : List<Call>
```

---

### 하위 수준 모듈

* `CSVReader implements Reader`
* `JSONReader implements Reader`

👉 **세부 구현이 인터페이스에 의존**

---

### 상위 수준 모듈

```text
CallCollector → Reader (인터페이스)
```

👉 **구현체를 모름**
👉 **변경에 안전**

---

## 7️⃣ 그런데 아직 남은 문제 ⚠️

❗ **생성자에서 CSVReader를 직접 생성**

```text
new CSVReader()
```

➡️ 구현체 변경 시 상위 수준 수정 필요
➡️ 여전히 DIP 완전 충족 ❌

---

## 8️⃣ 최종 해결책: 의존성 주입 (DI) 💉

### 핵심 아이디어

> **객체를 사용하는 책임과 생성하는 책임을 분리**

---

### 외부 객체 (조립자 / 설정자)

* Reader 구현체를 생성
* CallCollector에 주입

---

### CallCollector

```text
생성자에서 Reader를 주입받음
```

✅ 더 이상 하위 수준 모듈 생성 안 함
✅ DIP 완전 충족

---

## 9️⃣ 의존성 주입의 3가지 방식

| 방식     | 설명                    |
| ------ | --------------------- |
| 생성자 주입 | 생성 시 모든 의존성 주입 (⭐ 추천) |
| 세터 주입  | setter로 나중에 주입        |
| 메서드 주입 | 메서드 호출 시 파라미터로 전달     |

👉 **가장 권장: 생성자 주입**

* 불완전한 객체 생성 방지
* 의존성 명확

---

## 🔁 전체 의존성 구조 요약

```text
[ Client ]
    ↓
[ Reader 구현체 생성 ]
    ↓
[ CallCollector ]
    ↓
[ Reader 인터페이스 ]
    ↑
[ CSVReader / JSONReader ]
```

---

## 🧠 장기 기억을 위한 핵심 정리

### DIP의 본질

* ❌ 구현에 의존하지 말 것
* ✅ **의도와 역할(추상화)에 의존할 것**

---

### DIP + DI 조합 효과

* 변경에 강한 설계
* 테스트 용이
* 확장성 증가
* 책임 분리 명확

---

### 한 문장 요약 (면접용)

> **의존성 역전 원칙은 상위 수준 정책이 하위 수준 구현에 흔들리지 않도록,
> 모든 의존성을 추상화로 뒤집는 설계 원칙이다.**

---
