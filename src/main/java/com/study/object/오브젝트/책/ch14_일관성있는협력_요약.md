# Chapter 14. 일관성 있는 협력

## 1. 일관성의 중요성

### 일관성 없는 코드의 문제점
```
일관성 없는 코드
├── 코드 이해 어려움
├── 기능 추가할수록 일관성 더 어긋남
└── 심리적 장벽 형성
```

### 핵심 원칙
> **유사한 기능은 유사한 방식으로 구현하라**
>
> 유지보수 가능한 시스템의 첫걸음 = 협력을 일관성 있게 만드는 것

---

## 2. 일관성 있는 설계를 위한 조언

### 가장 좋은 방법
```
디자인 패턴 학습
├── 전문가의 경험을 빠르게 흡수
├── 반복 적용 가능한 설계 구조 제공
└── 변경이라는 문맥 안에서 적용해보기
```

### 기본 지침 (패턴이 없을 때)
| 지침 | 설명 |
|------|------|
| **분리** | 변하는 개념을 변하지 않는 개념으로부터 분리 |
| **캡슐화** | 변하는 개념을 캡슐화 |

> 변경에 초점 + 캡슐화 관점 = 일관성 있는 협력 패턴

---

## 3. 캡슐화 다시 살펴보기

### 캡슐화 ≠ 데이터 은닉
```
┌────────────────────────────────────────────────────┐
│  캡슐화 = 변할 수 있는 모든 개념을 감추는 것        │
│         = 코드 수정의 파급효과를 제어하는 모든 기법 │
└────────────────────────────────────────────────────┘
```

### 캡슐화의 4가지 종류
| 종류 | 설명 |
|------|------|
| **데이터 캡슐화** | 내부 상태를 private으로 숨김 |
| **메서드 캡슐화** | 내부 구현 메서드를 private으로 숨김 |
| **객체 캡슐화** | 객체 간의 관계를 숨김 (합성) |
| **서브타입 캡슐화** | 구체 타입을 추상화 뒤에 숨김 (다형성) |

---

## 4. 변경 캡슐화 전략

### 가장 일반적인 방법: 서브타입 캡슐화 + 객체 캡슐화

```
[Step 1] 변하는 부분 분리 → 타입 계층 생성
┌─────────────────────────────────────────┐
│  변하는 부분들의 공통 행동              │
│  → 추상 클래스/인터페이스로 추상화      │
│  → 변하는 부분들이 이를 상속            │
└─────────────────────────────────────────┘

[Step 2] 변하지 않는 부분에 타입 계층 합성
┌─────────────────────────────────────────┐
│  변하지 않는 부분                        │
│  → 구체적인 사항에 결합 ❌               │
│  → 의존성 주입으로 추상화에만 의존 ✅    │
└─────────────────────────────────────────┘
```

### 구조
```
┌──────────────────┐
│ 변하지 않는 부분  │───────→ [추상화]
└──────────────────┘              ↑
                            ┌─────┴─────┐
                         [구현1]    [구현2]
                         (변하는 부분들)
```

---

## 5. 개념적 무결성 (Conceptual Integrity)

> 시스템 설계에서 **가장 중요한 것**
>
> 하나로 통합된 일련의 설계 아이디어를 반영하는 시스템이 훨씬 좋다

---

## 6. 패턴을 찾아라

### 일관성 있는 협력의 핵심
```
변경 분리 → 변경 캡슐화 → 역할/책임 결정 → 협력 결정 → 코드 구조 결정
```

### 훌륭한 설계자가 되는 방법
| 단계 | 내용 |
|------|------|
| **1단계** | 변경의 방향을 파악하는 날카로운 감각 기르기 |
| **2단계** | 변경에 탄력적으로 대응하는 캡슐화/설계 방법 익히기 |

### 실천 지침
```
유사한 기능에 변경이 지속적으로 발생한다면:
1. 적절한 추상화 찾기
2. 추상화에 변하지 않는 공통 책임 할당
3. 구조가 부적합하면 리팩터링
4. 적절한 역할/책임 찾기
→ 협력의 일관성이 서서히 드러남
```

---

## 핵심 정리

### 일관성 있는 협력 = 변경 캡슐화
```
┌────────────────────────────────────────────────────┐
│  협력을 일관성 있게 만든다                         │
│  = 유사한 변경을 수용할 수 있는 협력 패턴 발견     │
└────────────────────────────────────────────────────┘
```

### 기억할 원칙
| 원칙 | 내용 |
|------|------|
| **일관성** | 유사한 기능 → 유사한 구현 방식 |
| **캡슐화** | 데이터 은닉 이상, 변경의 파급효과 제어 |
| **분리+합성** | 변하는 것은 타입 계층으로, 변하지 않는 것에 합성 |
| **추상화 의존** | 구체적 사항이 아닌 추상화에만 의존 |
| **패턴 발견** | 반복 적용 가능한 협력 구조 찾기 |

### 한 줄 요약
> **일관성 = 변하는 것 분리 + 캡슐화 + 추상화에 의존**